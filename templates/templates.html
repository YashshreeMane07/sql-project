<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL AI - Reusable Templates</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
   <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" /> 
<script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="script.js"></script>
    <style>
        .template-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .template-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05) !important;
        }
        .use-btn {
            background: #1E8F5B;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        .use-btn:hover {
            background: #166a43;
        }
        .template-card h3 {
    white-space: normal;
}
.sql-box {
    background:#E8F8F0;
    padding:8px 12px;
    border-radius:8px;
    margin-bottom:14px;
    border:1px solid #B7E4C7;
    max-width:600px;
}

.sql-box code {
    color:#0D4A33;
    font-family:monospace;
    font-size:13px;
    white-space: pre-wrap;
    line-height:1.4;
}
    </style>
</head>

<body>
    <aside class="sidebar">
    <div class="brand">
       <div class="brand">
    <img src="{{ url_for('static', filename='sql_logo.png') }}" alt="Logo" class="brand-logo-img" />
</div>
    </div>
    <div class="menu-label">MENU</div>
   <ul class="nav-list">
   <li class="nav-item active" onclick="window.location.href='/dashboard'">
        <i class="ph ph-squares-four"></i> <span>Overview</span>
    </li>

     <li class="nav-item" onclick="window.location.href='/ask_page'">
    <i class="ph ph-sparkle"></i> <span>Ask AI</span>
</li>

    <li class="nav-item" onclick="window.location.href='/history'">
        <i class="ph ph-clock-counter-clockwise"></i> <span>Query History</span>
    </li>

    <li class="nav-item" onclick="window.location.href='/templates_page'">
        <i class="ph ph-copy-simple"></i> <span>Templates</span>
    </li>

</ul>
    <div class="menu-label" style="margin-top: 20px">GENERAL</div>
      <ul class="nav-list">
        <li class="nav-item"><i class="ph ph-user"></i><span>Profile</span></li>
        <li class="nav-item">
          <i class="ph ph-book"></i><span>Help/Tutorial</span>
        </li>
        <li class="nav-item">
          <i class="ph ph-gear"></i><span>Settings</span>
        </li>
      <li class="nav-item" onclick="handleLogout()">
    <i class="ph ph-sign-out"></i><span>Logout</span>
</li>
        
      </ul>
</aside>

    <main class="main-content">
        <header>
            <div class="search-bar">
                <i class="ph ph-magnifying-glass"></i>
                <input type="text" placeholder="Search templates..." id="templateSearch" onkeyup="filterTemplates()" />
            </div>
            <div class="header-actions">
                <div class="user-profile">
                    <div class="user-info">
                        <div class="user-name">Username</div>
                        <div class="user-email">email@id.com</div>
                    </div>
                    <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&w=100&q=80" alt="Profile" class="avatar" style="width: 35px; border-radius: 50%;" />
                </div>
            </div>
        </header>

        <div class="dashboard-container" style="padding: 30px; background-color: #f9fafb; min-height: 100vh;">
            <div class="welcome-section" style="margin-bottom: 32px;">
                <h1 class="welcome-title" style="color: #0D4A33; font-size: 28px; font-weight: 700; margin-bottom: 8px;">Reusable Templates</h1>
                <div style="display: flex; align-items: center; gap: 8px; color: #6D737A; font-size: 14px;">
                    <i class="ph ph-lightning" style="color: #1E8F5B; font-size: 18px;"></i>
                    <span>Deploy saved patterns to your database in one click.</span>
                </div>
            </div>

            <div id="templateContainer" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                </div>
        </div>
    </main>

    <script>
        // --- 1. LOGIC FUNCTIONS ---

      // This function captures the SQL from the template and sends it to the dashboard
function handleUseQuery(sql) {
    // Save SQL to localStorage
    localStorage.setItem('pendingQuery', sql);

    // Redirect to Ask AI page
    window.location.href = '/ask_page';
}

        // Deletes template from localStorage (For Real DB, you will change this to an API fetch)
        function deleteTemplate(id) {
            if (confirm("Are you sure you want to delete this template?")) {
                let templates = JSON.parse(localStorage.getItem('myTemplates')) || [];
                const updatedTemplates = templates.filter(t => t.id !== id);
                localStorage.setItem('myTemplates', JSON.stringify(updatedTemplates));
                loadTemplates(); 
            }
        }

        // Search Filter Logic
        function filterTemplates() {
            const searchTerm = document.getElementById('templateSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.template-card');
            cards.forEach(card => {
                const title = card.querySelector('h3').innerText.toLowerCase();
                card.style.display = title.includes(searchTerm) ? "block" : "none";
            });
        }

        // --- 2. UI RENDERER ---

        function loadTemplates() {
            const container = document.getElementById('templateContainer');
            
            // To use Real MySQL data later, you will fetch('http://your-api.com/templates') here
            const templates = JSON.parse(localStorage.getItem('myTemplates')) || [];

            if (templates.length === 0) {
                container.innerHTML = `<div style="text-align:center; padding:50px; color:#6b7280; background: white; border-radius: 16px; border: 1px dashed #ccc;">No templates saved.</div>`;
                return;
            }

            container.innerHTML = templates.map(t => `
                <div class="template-card" style="background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:24px;">
                   
                    <h3 style="margin: 12px 0; color:#0D4A33; font-weight: 700;">${t.title}</h3>


                    <div class="sql-box">
    <code>${t.sql}</code>
</div>

                    <div style="display: flex; justify-content: flex-end; gap: 12px; border-top: 1px solid #f3f4f6; padding-top: 16px;">
                        <button onclick="deleteTemplate(${t.id})" 
                                style="background: #FFF1F1; color: #FA5252; border: 1px solid #FFDADA; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="ph ph-trash"></i> Delete
                        </button>

                   <button class="use-btn" data-prompt="${encodeURIComponent(t.title)}" onclick="handleUseTemplate(this)">
    <i class="ph ph-play-fill"></i> Use Template
</button>
                    </div>
                </div>
            `).join('');
        }

        window.onload = loadTemplates;

      function handleUseTemplate(button) {

    const prompt = decodeURIComponent(button.getAttribute("data-prompt"));

    // Save PROMPT
    localStorage.setItem("pendingQuery", prompt);

    // Go to Ask AI page
    window.location.href = "/ask_page";
}
    </script>
</body>
</html>